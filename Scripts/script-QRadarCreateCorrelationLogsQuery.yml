commonfields:
  id: QRadarCreateCorrelationLogsQuery
  version: -1
name: QRadarCreateCorrelationLogsQuery
script: |
  QUERY = "select RULENAME({0}), sourceip, destinationip, eventcount, sourceport, username, starttime, destinationport, magnitude, identityip, CATEGORYNAME(category), PROTOCOLNAME(protocolid), LOGSOURCENAME(logsourceid){1} from events where \"CRE Name\" IS NULL AND INOFFENSE({2}) START '{3}'"

  d_args = demisto.args()

  offense_id = demisto.get(d_args, 'offenseID')
  start_time = demisto.get(d_args, 'startTime')
  correlation_id = demisto.get(d_args, 'qid')
  additional_query_fields = demisto.get(d_args,'additionalQueryFields') if demisto.get(d_args,'additionalQueryFields') else ''

  ec = {'QRadar.CorrelationQuery': QUERY.format(correlation_id,additional_query_fields,offense_id,start_time)}
  demisto.results({
              'Type': entryTypes['note'],
              'EntryContext': ec,
              'ContentsFormat': formats['json'],
              'Contents': ec
          })
type: python
tags:
- Utility
comment: Creates a correlations logs query.
enabled: true
args:
- name: offenseID
  required: true
  default: true
  description: The offense ID to query.
- name: startTime
  required: true
  description: query from startTime (in timestamp format).
- name: qid
  required: true
  description: The Correlation QID to query.
- name: additionalQueryFields
  description: Add more fields for basic query (a list with comma separators)
outputs:
- contextPath: QRadar.CorrelationQuery
  description: The query created from the input.
  type: string
scripttarget: 0
runonce: false
releaseNotes: "-"
tests:
  - Forgive me for my sins but I did not create any test
